---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Sidebar from "../components/Sidebar.astro";

const { title } = Astro.props;
const { css } = Astro.props;
const { js } = Astro.props;
// サイドバー付きレイアウトを欲しいときは true を渡す
const { sidebar } = Astro.props;
// ナビリンクはページが増えたらここで中央管理
const navLinks = Astro.props.links || [
  { href: "/", label: "HOME" },
  { href: "/files", label: "ファイルたち" },
  { href: "/test", label: "テストページ" },
];

---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>{title}</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="alternate icon" href="/favicon.ico" sizes="any" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <script is:inline>
      (() => {
        try {
          const saved = localStorage.getItem("theme");
          const preferred = window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";
          const theme = saved === "dark" || saved === "light" ? saved : preferred;
          document.documentElement.setAttribute("data-theme", theme);
        } catch {
          document.documentElement.setAttribute("data-theme", "light");
        }
      })();
    </script>
    <!-- デフォルトのCSSとJSを読み込む -->
    <link rel="stylesheet" href="/css/main.css"/>
    <link rel="stylesheet" href="/css/layout.css"/>
    {sidebar && <link rel="stylesheet" href="/css/listview.css"/>}
    <script type="module" src="/js/main.js" defer></script>
    <!-- 追加のCSSとJSを読み込む -->
    {css && (
      Array.isArray(css)
        ? css.map(href => <link rel="stylesheet" href={href} />)
        : <link rel="stylesheet" href={css} />
    )}
    {js && (
      Array.isArray(js)
        ? js.map(src => <script type="module" src={src} defer/>)
        : <script type="module" src={js} defer/>
    )}
  </head>
  <body>
    <Header links={navLinks} />

    {sidebar ? (
      <div class="content">
        <Sidebar>
          <slot name="sidebar" />
        </Sidebar>
        <main>
          <slot />
        </main>
      </div>
    ) : (
      <main>
        <slot />
      </main>
    )}

    <Footer />
  </body>
</html>
